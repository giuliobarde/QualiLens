@startuml Activity_Diagram_5_Evidence_Collection_and_Scoring
title Activity Diagram 5: Evidence Collection and Scoring

start

repeat
  partition "Analysis Tool" {
  :Extract text snippet from paper
  (max 500 chars);
  :Create evidence metadata:
  note right
    • category
    • rationale
    • confidence
    • severity
  end note
  :Call evidence_collector.add_evidence();
  }
  
  partition "Evidence Collector" {
  if (Page number provided?) then (yes)
    :Use provided page number;
  else (no)
    partition "Page Number Detection" {
    :Normalize text snippet;
    :Extract meaningful words
    (length > 2);
    
    repeat
      :For each page in pdf_pages;
      :Calculate word overlap;
      
      if (Overlap ≥ 50%?) then (yes)
        :Use detected page;
        break
      endif
    repeat while (More pages?) is (yes)
    ->no overlap found;
    
    :Default to page 1;
    }
  endif
  
  partition "Bounding Box Calculation" {
  if (Bounding box provided?) then (yes)
    :Use provided bounding box;
  else (no)
    :Calculate bounding box;
    
    if (Strategy 1:\nExact substring match?) then (yes)
      :Use exact block coordinates;
      
    elseif (Strategy 2:\nFuzzy match ≥ 80%?) then (yes)
      :Use fuzzy match coordinates;
      
    elseif (Strategy 3:\nPhrase match found?) then (yes)
      :Use phrase match coordinates;
      
    else (no)
      :Estimate bounding box;
      note right
        • x: 0.1
        • y: 0.2 + offset
        • width: 0.8
        • height: estimated
      end note
    endif
  endif
  }
  
  partition "Evidence Storage" {
  :Create and store EvidenceItem
  with unique ID;
  }
  }

repeat while (More findings from tools?) is (yes)
->no;

partition "Evidence-Based Scoring" {
:Get all evidence items;
:Group by category;
note right
  • bias
  • methodology
  • reproducibility
  • statistics
end note

partition "Calculate Component Scores (Hierarchical)" {
  :Calculate Methodology Score;
  :Initialize base_methodology_score = 50;
  :For each sub-criterion (3-5);
  note right
    • Study design quality
    • Sample size adequacy
    • Control group presence
    • Randomization method
    • Blinding procedures
  end note
  :Calculate sub-scores: si × ci
  (sub-score × confidence);
  :Aggregate sub-scores with weights;
  :Add/subtract score_impact
  from evidence items;
  :Clamp score to range 0-100;
  
  :Calculate Bias Score;
  :Initialize bias_score = 100;
  :For each sub-criterion (3-5);
  note right
    • Selection bias
    • Reporting bias
    • Statistical bias (p-hacking)
    • Linguistic framing bias
    • Confirmation bias
  end note
  :Calculate sub-scores: si × ci;
  :Aggregate sub-scores with weights;
  :Add score_impact from
  bias evidence items
  (impact typically negative);
  :Clamp score to range 0-100;
  
  :Calculate Reproducibility Score;
  :Initialize reproducibility_score = 50;
  :For each sub-criterion (3-5);
  note right
    • Raw data availability
    • Analysis code availability
    • Protocol documentation
    • Preregistration
    • Environment details
  end note
  :Calculate sub-scores: si × ci;
  :Aggregate sub-scores with weights;
  :Add score_impact from
  reproducibility evidence;
  :Clamp score to range 0-100;
  
  :Calculate Statistics Score;
  :Initialize statistics_score = 50;
  :For each sub-criterion (3-5);
  note right
    • Statistical test appropriateness
    • Effect size reporting
    • Confidence intervals
    • Multiple comparison correction
    • Power analysis
  end note
  :Calculate sub-scores: si × ci;
  :Aggregate sub-scores with weights;
  :Add/subtract score_impact
  from statistics evidence;
  :Clamp score to range 0-100;
}

partition "Percentile Normalization" {
:Load reference distribution
(N≥1000 papers);
:Stratify by domain and year;
:Calculate percentile rankings;
:Apply robust scaling (median, IQR);
:Normalize component scores;
}

partition "Uncertainty Quantification" {
:Bootstrap resampling (1000 iterations);
:Propagate model uncertainty;
:Calculate confidence intervals;
note right
  • 95% CI for each component
  • 95% CI for final score
end note
:Compute uncertainty metrics;
}

partition "Explanation Generation" {
:Generate NLG explanations;
note right
  "Methodology score is {score}
  (percentile: {pct}), driven
  primarily by {top_factors}.
  Evidence: {citations}"
end note
:Create detailed breakdowns;
}

:Apply weighted formula;
note right
  Final = Σ(wi × si × ci)
  where wi=weight, si=sub-score, ci=confidence
  
  Final = Methodology × 0.6
        + Bias × 0.2
        + Reproducibility × 0.1
        + Statistics × 0.1
end note

:Clamp score to 0-100;

:Package result;
note right
  • final_score
  • component_scores
  • sub_criteria_scores
  • weighted_contributions
  • percentile_rankings
  • confidence_intervals
  • uncertainty_metrics
  • evidence_count
  • explanations
end note
}

partition #E6F3FF "Scoring Results" {
:Return scoring results;
}

stop

@enduml
